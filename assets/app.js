angular.module("appLearn",["ngRoute"]),angular.module("appLearn").controller("ApplicationController",["$scope","$location","UserSvc",function(t,e,o){t.$on("login",function(e,o){t.currentUser=o}),t.logout=function(){o.logOut(),delete t.currentUser,e.path("/")}}]),angular.module("appLearn").controller("EditarMissatgeController",["$scope","$location","MissatgesService",function(t,e,o){t.missatgeBody=o.missatgeToEdit.body,t.editarMissatge=function(){t.missatgeBody&&o.put({_id:o.missatgeToEdit._id,body:t.missatgeBody}).success(function(){o.missatgeToEdit.body=t.missatgeBody,t.missatgeBody=null,e.path("/")})}}]),angular.module("appLearn").controller("LoginController",["$scope","$location","UserSvc",function(t,e,o){t.login=function(n,a){o.login(n,a).then(function(o){t.$emit("login",o.data),o.data&&e.path("/")})}}]),angular.module("appLearn").controller("MissatgesController",["$scope","$location","MissatgesService",function(t,e,o){o.fetch().success(function(e){t.missatges=e}).error(function(t){console.log(t)}),t.esborrarMissatge=function(t){o["delete"](t._id).success(function(){e.path("/")})},t.editarMissatge=function(t){console.log(t),o.edit(t),e.path("/editarmissatge")}}]),angular.module("appLearn").service("MissatgesService",["$http",function(t){this.fetch=function(){return t.get("/api/missatges")},this.create=function(e){return t.post("/api/missatges",e)},this["delete"]=function(e){return console.log(e),t["delete"]("/api/missatges/"+e)},this.edit=function(t){this.missatgeToEdit=t},this.put=function(e){return t.put("/api/missatges",e)}}]),angular.module("appLearn").controller("NouMissatgeController",["$scope","$location","MissatgesService",function(t,e,o){t.afegirMissatge=function(){console.log(t.missatgeBody),t.missatgeBody&&o.create({body:t.missatgeBody}).success(function(){e.path("/")})}}]),angular.module("appLearn").controller("RegistreController",["$scope","$location","UserSvc",function(t,e,o){t.registre=function(n,a){o.login(n,a).then(function(o){t.$emit("login",o.data),o.data&&e.path("/")})}}]),angular.module("appLearn").config(["$routeProvider",function(t){t.when("/",{controller:"MissatgesController",templateUrl:"missatges.html",autoritzat:!1}).when("/noumissatge",{controller:"NouMissatgeController",templateUrl:"nouMissatge.html",autoritzat:!0}).when("/editarmissatge",{controller:"EditarMissatgeController",templateUrl:"editarMissatge.html",autoritzat:!0}).when("/registre",{controller:"RegisterController",templateUrl:"register.html",autoritzat:!1}).when("/login",{controller:"LoginController",templateUrl:"login.html",autoritzat:!1}).when("/registre",{controller:"RegistreController",templateUrl:"registre.html",autoritzat:!1})}]).run(["$rootScope","UserSvc",function(t,e){t.$on("$routeChangeStart",function(t,o){o&&!e.auth&o.autoritzat&&t.preventDefault()})}]),angular.module("appLearn").service("UserSvc",["$http",function(t){var e=this;e.auth=!1,e.getUser=function(){return t.get("/api/users")},e.login=function(o,n){return t.post("/api/sessions",{username:o,password:n}).then(function(o){return e.token=o.data,t.defaults.headers.common["x-auth"]=o.data,o.data&&(e.auth=!0),e.getUser()})},e.registre=function(o,n){return t.post("/api/users",{username:o,password:n}).then(function(o){return e.token=o.data,t.defaults.headers.common["x-auth"]=o.data,o.data&&(e.auth=!0),e.getUser()})},e.logOut=function(){e.auth=!1,t.defaults.headers.common["x-auth"]=""}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJlZGl0TWlzc2F0Z2UuY3RybC5qcyIsImxvZ2luLmN0cmwuanMiLCJtaXNzYXRnZXMuY3RybC5qcyIsIm1pc3NhdGdlcy5zdmMuanMiLCJub3VNaXNzYXRnZS5jdHJsLmpzIiwicmVnaXN0cmUuY3RybC5qcyIsInJvdXRlcy5qcyIsInVzZXIuc3ZjLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiVXNlclN2YyIsIiRvbiIsImUiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJsb2dPdXQiLCJwYXRoIiwiTWlzc2F0Z2VzU2VydmljZSIsIm1pc3NhdGdlQm9keSIsIm1pc3NhdGdlVG9FZGl0IiwiYm9keSIsImVkaXRhck1pc3NhdGdlIiwicHV0IiwiX2lkIiwic3VjY2VzcyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInRoZW4iLCIkZW1pdCIsImRhdGEiLCJmZXRjaCIsIm1pc3NhdGdlcyIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImVzYm9ycmFyTWlzc2F0Z2UiLCJtaXNzYXRnZSIsImVkaXQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwiY3JlYXRlIiwicG9zdCIsImlkIiwiYWZlZ2lyTWlzc2F0Z2UiLCJyZWdpc3RyZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiYXV0b3JpdHphdCIsInJ1biIsIiRyb290U2NvcGUiLCJldmVudCIsIm5leHQiLCJhdXRoIiwicHJldmVudERlZmF1bHQiLCJzdmMiLCJnZXRVc2VyIiwidmFsIiwidG9rZW4iLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLFlBQUEsWUNBQUQsUUFBQUMsT0FBQSxZQUNBQyxXQUFBLHlCQUFBLFNBQUEsWUFBQSxV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c291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJyxbJ25nUm91dGUnXSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcihcIkFwcGxpY2F0aW9uQ29udHJvbGxlclwiLCBmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLFVzZXJTdmMpIHtcbiAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihlLHVzZXIpIHtcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIFVzZXJTdmMubG9nT3V0KCk7XG4gICAgICAgICAgICBkZWxldGUgJHNjb3BlLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgfTtcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKCdFZGl0YXJNaXNzYXRnZUNvbnRyb2xsZXInLGZ1bmN0aW9uKCRzY29wZSwkbG9jYXRpb24sTWlzc2F0Z2VzU2VydmljZSkge1xuICAgICAgICAkc2NvcGUubWlzc2F0Z2VCb2R5ID0gTWlzc2F0Z2VzU2VydmljZS5taXNzYXRnZVRvRWRpdC5ib2R5O1xuICAgICAgICAkc2NvcGUuZWRpdGFyTWlzc2F0Z2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubWlzc2F0Z2VCb2R5KXtcbiAgICAgICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLnB1dCh7XG4gICAgICAgICAgICAgICAgICAgIFwiX2lkXCI6TWlzc2F0Z2VzU2VydmljZS5taXNzYXRnZVRvRWRpdC5faWQsXG4gICAgICAgICAgICAgICAgICAgIFwiYm9keVwiOiRzY29wZS5taXNzYXRnZUJvZHlcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLm1pc3NhdGdlVG9FZGl0LmJvZHkgPSAkc2NvcGUubWlzc2F0Z2VCb2R5O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2F0Z2VCb2R5PW51bGw7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcihcIkxvZ2luQ29udHJvbGxlclwiLCBmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLFVzZXJTdmMpIHtcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUscGFzc3dvcmQpIHtcbiAgICAgICAgICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUscGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlci5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuZGF0YSkgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KTtcbiAgICBcbiAgICBcbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9vcGluaW9uYXRlZC1hbmd1bGFyanMvdGVjaG5pcXVlcy1mb3ItYXV0aGVudGljYXRpb24taW4tYW5ndWxhcmpzLWFwcGxpY2F0aW9ucy03YmJmMDM0NmFjZWMiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKCdNaXNzYXRnZXNDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgLy8kc2NvcGUubWlzc2F0Z2VCb2R5PVwiaG9sYWFhYVwiO1xuICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmZldGNoKClcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obWlzc2F0Z2VzKXtcbiAgICAgICAgICAgICRzY29wZS5taXNzYXRnZXMgPSBtaXNzYXRnZXM7XG4gICAgICAgIH0pXG4gICAgICAgIC5lcnJvcihmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICB9KTtcblxuICAgICAgXG4gICAgICAgICRzY29wZS5lc2JvcnJhck1pc3NhdGdlID0gZnVuY3Rpb24obWlzc2F0Z2UpIHtcbiAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZGVsZXRlKG1pc3NhdGdlLl9pZCkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmVkaXRhck1pc3NhdGdlID0gZnVuY3Rpb24obWlzc2F0Z2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1pc3NhdGdlKTtcbiAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZWRpdChtaXNzYXRnZSk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2VkaXRhcm1pc3NhdGdlJyk7XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuc2VydmljZShcIk1pc3NhdGdlc1NlcnZpY2VcIiwgZnVuY3Rpb24oJGh0dHApIHtcbiAgICAgICAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChcIi9hcGkvbWlzc2F0Z2VzXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChcIi9hcGkvbWlzc2F0Z2VzXCIsIG1pc3NhdGdlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kZWxldGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coaWQpO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZShcIi9hcGkvbWlzc2F0Z2VzL1wiK2lkKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5lZGl0ID0gZnVuY3Rpb24obWlzc2F0Z2Upe1xuICAgICAgICAgICAgdGhpcy5taXNzYXRnZVRvRWRpdCA9IG1pc3NhdGdlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnB1dCA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KFwiL2FwaS9taXNzYXRnZXNcIiwgbWlzc2F0Z2UpO1xuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcignTm91TWlzc2F0Z2VDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLmFmZWdpck1pc3NhdGdlID0gZnVuY3Rpb24ocGF0YXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubWlzc2F0Z2VCb2R5KTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubWlzc2F0Z2VCb2R5KXtcbiAgICAgICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJvZHk6JHNjb3BlLm1pc3NhdGdlQm9keVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcihcIlJlZ2lzdHJlQ29udHJvbGxlclwiLCBmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLFVzZXJTdmMpIHtcbiAgICAgICAgJHNjb3BlLnJlZ2lzdHJlID0gZnVuY3Rpb24odXNlcm5hbWUscGFzc3dvcmQpIHtcbiAgICAgICAgICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUscGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlci5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuZGF0YSkgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KTtcbiAgICAiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKFwiL1wiLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ01pc3NhdGdlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWlzc2F0Z2VzLmh0bWwnLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbm91bWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTm91TWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdub3VNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvZWRpdGFybWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiRWRpdGFyTWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGl0YXJNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0ZXJDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0ZXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbG9naW5cIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTG9naW5Db250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwibG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0cmVDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0cmUuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSxVc2VyU3ZjKSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBuZXh0KSB7XG4gICAgICAgICAgIGlmIChuZXh0KVxuICAgICAgICAgICAgICAgIGlmICghVXNlclN2Yy5hdXRoICYgbmV4dC5hdXRvcml0emF0KSBcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHZhciBzdmMgPSB0aGlzO1xuICAgICAgICBzdmMuYXV0aD0gZmFsc2U7XG4gICAgICAgIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgc3ZjLnRva2VuID0gdmFsLmRhdGE7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gdmFsLmRhdGE7XG4gICAgICAgICAgICAgICAgaWYgKHZhbC5kYXRhKSBzdmMuYXV0aCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXRVc2VyKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgc3ZjLnJlZ2lzdHJlID0gZnVuY3Rpb24odXNlcm5hbWUscGFzc3dvcmQpe1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMnLCB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgICAgICBzdmMudG9rZW4gPSB2YWwuZGF0YTtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1hdXRoJ10gPSB2YWwuZGF0YTtcbiAgICAgICAgICAgICAgICBpZiAodmFsLmRhdGEpIHN2Yy5hdXRoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ZjLmdldFVzZXIoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5sb2dPdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHN2Yy5hdXRoID0gZmFsc2U7XG4gICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1hdXRoJ10gPVwiXCI7XG4gICAgICAgIH07XG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9