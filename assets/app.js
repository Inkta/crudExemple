angular.module("appLearn",["ngRoute"]),angular.module("appLearn").controller("ApplicationController",["$scope","$location","UserSvc",function(e,t,o){e.$on("login",function(t,o){e.currentUser=o}),e.logout=function(){o.logOut(),delete e.currentUser,t.path("/")}}]),angular.module("appLearn").controller("EditarMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.missatgeBody=o.missatgeToEdit.body,e.editarMissatge=function(){e.missatgeBody&&o.put({_id:o.missatgeToEdit._id,body:e.missatgeBody}).success(function(){o.missatgeToEdit.body=e.missatgeBody,e.missatgeBody=null,t.path("/")})}}]),angular.module("appLearn").controller("LoginController",["$scope","$location","UserSvc",function(e,t,o){e.login=function(r,s){e.$watchGroup(["username","password"],function(t,o){t!=o&&(e.error=null)}),r&&s?(console.log(o),o.login(r,s,function(t,o){401==o&&(e.error=t.missatge)}).success(function(){o.getUser().then(function(o){console.log(o),e.$emit("login",o.data),t.path("/")})})):e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").controller("MissatgesController",["$scope","$route","$location","MissatgesService",function(e,t,o,r){r.fetch().success(function(t){e.missatges=t}),e.esborrarMissatge=function(e){r["delete"](e._id).success(function(){t.reload(),console.log("hola")})},e.editarMissatge=function(e){r.edit(e),o.path("/editarmissatge")}}]),angular.module("appLearn").service("MissatgesService",["$http",function(e){this.fetch=function(){return e.get("/api/missatges")},this.create=function(t){return e.post("/api/missatges",t)},this["delete"]=function(t){return console.log(t),e["delete"]("/api/missatges/"+t)},this.edit=function(e){this.missatgeToEdit=e},this.put=function(t){return e.put("/api/missatges",t)}}]),angular.module("appLearn").controller("NouMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.afegirMissatge=function(){console.log(e.missatgeBody),e.missatgeBody&&o.create({body:e.missatgeBody}).success(function(){t.path("/")})}}]),angular.module("appLearn").controller("RegistreController",["$scope","$location","UserSvc",function(e,t,o){e.registre=function(r,s,n){e.$watchGroup(["username","password","password2"],function(t,o){t!=o&&(e.error=null)}),s&&n&&r?s===n?o.registre(r,s).success(function(){t.path("/login")}).error(function(t,o){409==o&&(e.error=t.missatge)}):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{controller:"MissatgesController",templateUrl:"missatges.html",autoritzat:!1}).when("/noumissatge",{controller:"NouMissatgeController",templateUrl:"nouMissatge.html",autoritzat:!0}).when("/editarmissatge",{controller:"EditarMissatgeController",templateUrl:"editarMissatge.html",autoritzat:!0}).when("/registre",{controller:"RegisterController",templateUrl:"register.html",autoritzat:!1}).when("/login",{controller:"LoginController",templateUrl:"login.html",autoritzat:!1}).when("/registre",{controller:"RegistreController",templateUrl:"registre.html",autoritzat:!1}),t.html5Mode({enabled:!0,requireBase:!1})}]).run(["$rootScope","UserSvc",function(e,t){e.$on("$routeChangeStart",function(e,o){o&&!t.auth&o.autoritzat&&e.preventDefault()})}]),angular.module("appLearn").service("UserSvc",["$http",function(e){var t=this;t.auth=!1,t.getUser=function(){return e.get("/api/users")},t.login=function(o,r,s){return e.post("/api/sessions",{username:o,password:r}).success(function(o){t.token=o,e.defaults.headers.common["x-auth"]=o,o&&(t.auth=!0)}).error(function(e,t){s(e,t)})},t.registre=function(t,o){return e.post("/api/users",{username:t,password:o})},t.logOut=function(){t.auth=!1,e.defaults.headers.common["x-auth"]=""}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJlZGl0TWlzc2F0Z2UuY3RybC5qcyIsImxvZ2luLmN0cmwuanMiLCJtaXNzYXRnZXMuY3RybC5qcyIsIm1pc3NhdGdlcy5zdmMuanMiLCJub3VNaXNzYXRnZS5jdHJsLmpzIiwicmVnaXN0cmUuY3RybC5qcyIsInJvdXRlcy5qcyIsInVzZXIuc3ZjLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiVXNlclN2YyIsIiRvbiIsImUiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJsb2dPdXQiLCJwYXRoIiwiTWlzc2F0Z2VzU2VydmljZSIsIm1pc3NhdGdlQm9keSIsIm1pc3NhdGdlVG9FZGl0IiwiYm9keSIsImVkaXRhck1pc3NhdGdlIiwicHV0IiwiX2lkIiwic3VjY2VzcyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIiR3YXRjaEdyb3VwIiwibmV3VmFsIiwib2xkVmFsIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwibWlzc2F0Z2UiLCJnZXRVc2VyIiwidGhlbiIsIiRlbWl0IiwiZGF0YSIsIiRyb3V0ZSIsImZldGNoIiwibWlzc2F0Z2VzIiwiZXNib3JyYXJNaXNzYXRnZSIsInJlbG9hZCIsImVkaXQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwiY3JlYXRlIiwicG9zdCIsImlkIiwiYWZlZ2lyTWlzc2F0Z2UiLCJyZWdpc3RyZSIsInBhc3N3b3JkMiIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJhdXRvcml0emF0IiwiaHRtbDVNb2RlIiwiZW5hYmxlZCIsInJlcXVpcmVCYXNlIiwicnVuIiwiJHJvb3RTY29wZSIsImV2ZW50IiwibmV4dCIsImF1dGgiLCJwcmV2ZW50RGVmYXVsdCIsInN2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QUFBRSxJQUFBLGVBRUFzQixFQUFBOUMsTUFBQSxTQUFBQyxFQUFBQyxFQUFBNkMsR0FDQSxNQUFBekIsR0FBQUksS0FBQSxpQkFDQXpCLFNBQUFBLEVBQ0FDLFNBQUFBLElBQ0FILFFBQUEsU0FBQWUsR0FDQWdDLEVBQUFFLE1BQUFsQyxFQUNBUSxFQUFBMkIsU0FBQUMsUUFBQUMsT0FBQSxVQUFBckMsRUFDQUEsSUFBQWdDLEVBQUFGLE1BQUEsS0FDQXRDLE1BQUEsU0FBQUEsRUFBQUcsR0FDQXNDLEVBQUF6QyxFQUFBRyxNQUdBcUMsRUFBQWpCLFNBQUEsU0FBQTVCLEVBQUFDLEdBQ0EsTUFBQW9CLEdBQUFJLEtBQUEsY0FDQXpCLFNBQUFBLEVBQ0FDLFNBQUFBLEtBR0E0QyxFQUFBeEQsT0FBQSxXQUNBd0QsRUFBQUYsTUFBQSxFQUNBdEIsRUFBQTJCLFNBQUFDLFFBQUFDLE9BQUEsVUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nLFsnbmdSb3V0ZSddKTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKFwiQXBwbGljYXRpb25Db250cm9sbGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwkbG9jYXRpb24sVXNlclN2Yykge1xuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKGUsdXNlcikge1xuICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgVXNlclN2Yy5sb2dPdXQoKTtcbiAgICAgICAgICAgIGRlbGV0ZSAkc2NvcGUuY3VycmVudFVzZXI7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoJ0VkaXRhck1pc3NhdGdlQ29udHJvbGxlcicsZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixNaXNzYXRnZXNTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5taXNzYXRnZUJvZHkgPSBNaXNzYXRnZXNTZXJ2aWNlLm1pc3NhdGdlVG9FZGl0LmJvZHk7XG4gICAgICAgICRzY29wZS5lZGl0YXJNaXNzYXRnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5taXNzYXRnZUJvZHkpe1xuICAgICAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UucHV0KHtcbiAgICAgICAgICAgICAgICAgICAgXCJfaWRcIjpNaXNzYXRnZXNTZXJ2aWNlLm1pc3NhdGdlVG9FZGl0Ll9pZCxcbiAgICAgICAgICAgICAgICAgICAgXCJib2R5XCI6JHNjb3BlLm1pc3NhdGdlQm9keVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UubWlzc2F0Z2VUb0VkaXQuYm9keSA9ICRzY29wZS5taXNzYXRnZUJvZHk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNzYXRnZUJvZHk9bnVsbDtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKFwiTG9naW5Db250cm9sbGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwkbG9jYXRpb24sVXNlclN2Yykge1xuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCkge1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaEdyb3VwKFsndXNlcm5hbWUnLCdwYXNzd29yZCddLGZ1bmN0aW9uKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCE9b2xkVmFsKVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3I9bnVsbDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF1c2VybmFtZSB8fCAhcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkhhcyBkJ2VtcGxlbmFyIHRvdHMgZWxzIGNhbXBzXCI7XG4gICAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coVXNlclN2Yyk7XG4gICAgICAgICAgICAgICAgVXNlclN2Yy5sb2dpbih1c2VybmFtZSxwYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyb3Isc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgVXNlclN2Yy5nZXRVc2VyKCkudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlci5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvKi50aGVuKGZ1bmN0aW9uKGluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGluZm8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8uc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBpbmZvLmVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgaW5mby51c2VyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pOyovXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcignTWlzc2F0Z2VzQ29udHJvbGxlcicsZnVuY3Rpb24oJHNjb3BlLCRyb3V0ZSwkbG9jYXRpb24sTWlzc2F0Z2VzU2VydmljZSkge1xuICAgICAgICAvLyRzY29wZS5taXNzYXRnZUJvZHk9XCJob2xhYWFhXCI7XG4gICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZmV0Y2goKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihtaXNzYXRnZXMpe1xuICAgICAgICAgICAgJHNjb3BlLm1pc3NhdGdlcyA9IG1pc3NhdGdlcztcbiAgICAgICAgfSk7XG5cbiAgICAgIFxuICAgICAgICAkc2NvcGUuZXNib3JyYXJNaXNzYXRnZSA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmRlbGV0ZShtaXNzYXRnZS5faWQpLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgLy8gJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAkcm91dGUucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdob2xhJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5lZGl0YXJNaXNzYXRnZSA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmVkaXQobWlzc2F0Z2UpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9lZGl0YXJtaXNzYXRnZScpO1xuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLnNlcnZpY2UoXCJNaXNzYXRnZXNTZXJ2aWNlXCIsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoXCIvYXBpL21pc3NhdGdlc1wiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihtaXNzYXRnZSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoXCIvYXBpL21pc3NhdGdlc1wiLCBtaXNzYXRnZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGVsZXRlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoXCIvYXBpL21pc3NhdGdlcy9cIitpZCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZWRpdCA9IGZ1bmN0aW9uKG1pc3NhdGdlKXtcbiAgICAgICAgICAgIHRoaXMubWlzc2F0Z2VUb0VkaXQgPSBtaXNzYXRnZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wdXQgPSBmdW5jdGlvbihtaXNzYXRnZSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dChcIi9hcGkvbWlzc2F0Z2VzXCIsIG1pc3NhdGdlKTtcbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoJ05vdU1pc3NhdGdlQ29udHJvbGxlcicsZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixNaXNzYXRnZXNTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5hZmVnaXJNaXNzYXRnZSA9IGZ1bmN0aW9uKHBhdGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLm1pc3NhdGdlQm9keSk7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm1pc3NhdGdlQm9keSl7XG4gICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBib2R5OiRzY29wZS5taXNzYXRnZUJvZHlcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJSZWdpc3RyZUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUucmVnaXN0cmUgPSBmdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCxwYXNzd29yZDIpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaEdyb3VwKFsndXNlcm5hbWUnLCdwYXNzd29yZCcsJ3Bhc3N3b3JkMiddLGZ1bmN0aW9uKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCE9b2xkVmFsKVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3I9bnVsbDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFwYXNzd29yZCB8fCAhcGFzc3dvcmQyIHx8ICF1c2VybmFtZSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJIYXMgZCdlbXBsZW5hciB0b3RzIGVscyBjYW1wc1wiO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfWVsc2UgaWYgKHBhc3N3b3JkID09PSBwYXNzd29yZDIpe1xuICAgICAgICAgICAgICAgIFVzZXJTdmMucmVnaXN0cmUodXNlcm5hbWUscGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yLHN0YXR1cyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwOSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiTGVzIGNvbnRyYXNlbnllcyBubyBzw7NuIGlndWFsc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuICAgICIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKFwiL1wiLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ01pc3NhdGdlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWlzc2F0Z2VzLmh0bWwnLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbm91bWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTm91TWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdub3VNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvZWRpdGFybWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiRWRpdGFyTWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGl0YXJNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0ZXJDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0ZXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbG9naW5cIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTG9naW5Db250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwibG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0cmVDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0cmUuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZUJhc2U6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSxVc2VyU3ZjKSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBuZXh0KSB7XG4gICAgICAgICAgIGlmIChuZXh0KVxuICAgICAgICAgICAgICAgIGlmICghVXNlclN2Yy5hdXRoICYgbmV4dC5hdXRvcml0emF0KSBcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHZhciBzdmMgPSB0aGlzO1xuICAgICAgICBzdmMuYXV0aD0gZmFsc2U7XG4gICAgICAgIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsbm9Mb2dpbikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLHN0YXR1cykge1xuICAgICAgICAgICAgICAgIHN2Yy50b2tlbiA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gZGF0YTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgc3ZjLmF1dGggPSB0cnVlO1xuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Isc3RhdHVzKXtcbiAgICAgICAgICAgICAgICBub0xvZ2luKGVycm9yLCBzdGF0dXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5yZWdpc3RyZSA9IGZ1bmN0aW9uKHVzZXJuYW1lLHBhc3N3b3JkKXtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBzdmMubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdmMuYXV0aCA9IGZhbHNlO1xuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID1cIlwiO1xuICAgICAgICB9O1xuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==