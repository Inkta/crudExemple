angular.module("appLearn",["ngRoute"]),angular.module("appLearn").controller("ApplicationController",["$scope","$location","UserSvc",function(e,t,o){e.$on("login",function(t,o){e.currentUser=o}),e.logout=function(){o.logOut(),delete e.currentUser,t.path("/")}}]),angular.module("appLearn").controller("EditarMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.missatgeBody=o.missatgeToEdit.body,e.editarMissatge=function(){e.missatgeBody&&o.put({_id:o.missatgeToEdit._id,body:e.missatgeBody}).success(function(){o.missatgeToEdit.body=e.missatgeBody,e.missatgeBody=null,t.path("/")})}}]),angular.module("appLearn").controller("LoginController",["$scope","$location","UserSvc",function(e,t,o){e.login=function(r,s){e.$watchGroup(["username","password"],function(t,o){t!=o&&(e.error=null)}),r&&s?(console.log(o),o.login(r,s,function(t,o){401==o&&(e.error=t.missatge)}).success(function(){o.getUser().then(function(o){console.log(o),e.$emit("login",o.data),t.path("/")})})):e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").controller("MissatgesController",["$scope","$route","$location","MissatgesService",function(e,t,o,r){r.fetch().success(function(t){e.missatges=t}),e.esborrarMissatge=function(e){r["delete"](e._id).success(function(){t.reload(),console.log("hola")})},e.editarMissatge=function(e){r.edit(e),o.path("/editarmissatge")}}]),angular.module("appLearn").service("MissatgesService",["$http",function(e){this.fetch=function(){return e.get("/api/missatges")},this.create=function(t){return e.post("/api/missatges",t)},this["delete"]=function(t){return console.log(t),e["delete"]("/api/missatges/"+t)},this.edit=function(e){this.missatgeToEdit=e},this.put=function(t){return e.put("/api/missatges",t)}}]),angular.module("appLearn").controller("NouMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.afegirMissatge=function(){console.log(e.missatgeBody),e.missatgeBody&&o.create({body:e.missatgeBody}).success(function(){t.path("/")})}}]),angular.module("appLearn").controller("RegistreController",["$scope","$location","UserSvc",function(e,t,o){e.registre=function(r,s,n){e.$watchGroup(["username","password","password2"],function(t,o){t!=o&&(e.error=null)}),s&&n&&r?s===n?o.registre(r,s).success(function(){t.path("/login")}).error(function(t,o){409==o&&(e.error=t.missatge)}):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").config(["$routeProvider",function(e){e.when("/",{controller:"MissatgesController",templateUrl:"missatges.html",autoritzat:!1}).when("/noumissatge",{controller:"NouMissatgeController",templateUrl:"nouMissatge.html",autoritzat:!0}).when("/editarmissatge",{controller:"EditarMissatgeController",templateUrl:"editarMissatge.html",autoritzat:!0}).when("/registre",{controller:"RegisterController",templateUrl:"register.html",autoritzat:!1}).when("/login",{controller:"LoginController",templateUrl:"login.html",autoritzat:!1}).when("/registre",{controller:"RegistreController",templateUrl:"registre.html",autoritzat:!1})}]).run(["$rootScope","UserSvc",function(e,t){e.$on("$routeChangeStart",function(e,o){o&&!t.auth&o.autoritzat&&e.preventDefault()})}]),angular.module("appLearn").service("UserSvc",["$http",function(e){var t=this;t.auth=!1,t.getUser=function(){return e.get("/api/users")},t.login=function(o,r,s){return e.post("/api/sessions",{username:o,password:r}).success(function(o){t.token=o,e.defaults.headers.common["x-auth"]=o,o&&(t.auth=!0)}).error(function(e,t){s(e,t)})},t.registre=function(t,o){return e.post("/api/users",{username:t,password:o})},t.logOut=function(){t.auth=!1,e.defaults.headers.common["x-auth"]=""}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJlZGl0TWlzc2F0Z2UuY3RybC5qcyIsImxvZ2luLmN0cmwuanMiLCJtaXNzYXRnZXMuY3RybC5qcyIsIm1pc3NhdGdlcy5zdmMuanMiLCJub3VNaXNzYXRnZS5jdHJsLmpzIiwicmVnaXN0cmUuY3RybC5qcyIsInJvdXRlcy5qcyIsInVzZXIuc3ZjLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiVXNlclN2YyIsIiRvbiIsImUiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJsb2dPdXQiLCJwYXRoIiwiTWlzc2F0Z2VzU2VydmljZSIsIm1pc3NhdGdlQm9keSIsIm1pc3NhdGdlVG9FZGl0IiwiYm9keSIsImVkaXRhck1pc3NhdGdlIiwicHV0IiwiX2lkIiwic3VjY2VzcyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIiR3YXRjaEdyb3VwIiwibmV3VmFsIiwib2xkVmFsIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwibWlzc2F0Z2UiLCJnZXRVc2VyIiwidGhlbiIsIiRlbWl0IiwiZGF0YSIsIiRyb3V0ZSIsImZldGNoIiwibWlzc2F0Z2VzIiwiZXNib3JyYXJNaXNzYXRnZSIsInJlbG9hZCIsImVkaXQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwiY3JlYXRlIiwicG9zdCIsImlkIiwiYWZlZ2lyTWlzc2F0Z2UiLCJyZWdpc3RyZSIsInBhc3N3b3JkMiIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiYXV0b3JpdHphdCIsInJ1biIsIiRyb290U2NvcGUiLCJldmVudCIsIm5leHQiLCJhdXRoIiwicHJldmVudERlZmF1bHQiLCJzdmMiLCJub0xvZ2luIiwidG9rZW4iLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iXSwibWFw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LFFBQUEsU0FBQWUsR0FDQTRCLEVBQUFFLE1BQUE5QixFQUNBUSxFQUFBdUIsU0FBQUMsUUFBQUMsT0FBQSxVQUFBakMsRUFDQUEsSUFBQTRCLEVBQUFGLE1BQUEsS0FDQWxDLE1BQUEsU0FBQUEsRUFBQUcsR0FDQWtDLEVBQUFyQyxFQUFBRyxNQUdBaUMsRUFBQWIsU0FBQSxTQUFBNUIsRUFBQUMsR0FDQSxNQUFBb0IsR0FBQUksS0FBQSxjQUNBekIsU0FBQUEsRUFDQUMsU0FBQUEsS0FHQXdDLEVBQUFwRCxPQUFBLFdBQ0FvRCxFQUFBRixNQUFBLEVBQ0FsQixFQUFBdUIsU0FBQUMsUUFBQUMsT0FBQSxVQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicsWyduZ1JvdXRlJ10pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJBcHBsaWNhdGlvbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oZSx1c2VyKSB7XG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBVc2VyU3ZjLmxvZ091dCgpO1xuICAgICAgICAgICAgZGVsZXRlICRzY29wZS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcignRWRpdGFyTWlzc2F0Z2VDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLm1pc3NhdGdlQm9keSA9IE1pc3NhdGdlc1NlcnZpY2UubWlzc2F0Z2VUb0VkaXQuYm9keTtcbiAgICAgICAgJHNjb3BlLmVkaXRhck1pc3NhdGdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm1pc3NhdGdlQm9keSl7XG4gICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5wdXQoe1xuICAgICAgICAgICAgICAgICAgICBcIl9pZFwiOk1pc3NhdGdlc1NlcnZpY2UubWlzc2F0Z2VUb0VkaXQuX2lkLFxuICAgICAgICAgICAgICAgICAgICBcImJvZHlcIjokc2NvcGUubWlzc2F0Z2VCb2R5XG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5taXNzYXRnZVRvRWRpdC5ib2R5ID0gJHNjb3BlLm1pc3NhdGdlQm9keTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc3NhdGdlQm9keT1udWxsO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJMb2dpbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWyd1c2VybmFtZScsJ3Bhc3N3b3JkJ10sZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsIT1vbGRWYWwpXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcj1udWxsO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiSGFzIGQnZW1wbGVuYXIgdG90cyBlbHMgY2FtcHNcIjtcbiAgICAgICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhVc2VyU3ZjKTtcbiAgICAgICAgICAgICAgICBVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnJvcixzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU3ZjLmdldFVzZXIoKS50aGVuKGZ1bmN0aW9uKHVzZXIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8qLnRoZW4oZnVuY3Rpb24oaW5mbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5zdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGluZm8uZXJyb3IubWlzc2F0Z2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCBpbmZvLnVzZXIuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7Ki9cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKCdNaXNzYXRnZXNDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJHJvdXRlLCRsb2NhdGlvbixNaXNzYXRnZXNTZXJ2aWNlKSB7XG4gICAgICAgIC8vJHNjb3BlLm1pc3NhdGdlQm9keT1cImhvbGFhYWFcIjtcbiAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5mZXRjaCgpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKG1pc3NhdGdlcyl7XG4gICAgICAgICAgICAkc2NvcGUubWlzc2F0Z2VzID0gbWlzc2F0Z2VzO1xuICAgICAgICB9KTtcblxuICAgICAgXG4gICAgICAgICRzY29wZS5lc2JvcnJhck1pc3NhdGdlID0gZnVuY3Rpb24obWlzc2F0Z2UpIHtcbiAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZGVsZXRlKG1pc3NhdGdlLl9pZCkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgICAgICRyb3V0ZS5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2hvbGEnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmVkaXRhck1pc3NhdGdlID0gZnVuY3Rpb24obWlzc2F0Z2UpIHtcbiAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZWRpdChtaXNzYXRnZSk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2VkaXRhcm1pc3NhdGdlJyk7XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuc2VydmljZShcIk1pc3NhdGdlc1NlcnZpY2VcIiwgZnVuY3Rpb24oJGh0dHApIHtcbiAgICAgICAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChcIi9hcGkvbWlzc2F0Z2VzXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChcIi9hcGkvbWlzc2F0Z2VzXCIsIG1pc3NhdGdlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kZWxldGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coaWQpO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZShcIi9hcGkvbWlzc2F0Z2VzL1wiK2lkKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5lZGl0ID0gZnVuY3Rpb24obWlzc2F0Z2Upe1xuICAgICAgICAgICAgdGhpcy5taXNzYXRnZVRvRWRpdCA9IG1pc3NhdGdlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnB1dCA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KFwiL2FwaS9taXNzYXRnZXNcIiwgbWlzc2F0Z2UpO1xuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcignTm91TWlzc2F0Z2VDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLmFmZWdpck1pc3NhdGdlID0gZnVuY3Rpb24ocGF0YXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubWlzc2F0Z2VCb2R5KTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubWlzc2F0Z2VCb2R5KXtcbiAgICAgICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJvZHk6JHNjb3BlLm1pc3NhdGdlQm9keVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcihcIlJlZ2lzdHJlQ29udHJvbGxlclwiLCBmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLFVzZXJTdmMpIHtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5yZWdpc3RyZSA9IGZ1bmN0aW9uKHVzZXJuYW1lLHBhc3N3b3JkLHBhc3N3b3JkMikge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWyd1c2VybmFtZScsJ3Bhc3N3b3JkJywncGFzc3dvcmQyJ10sZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsIT1vbGRWYWwpXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcj1udWxsO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXBhc3N3b3JkIHx8ICFwYXNzd29yZDIgfHwgIXVzZXJuYW1lKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkhhcyBkJ2VtcGxlbmFyIHRvdHMgZWxzIGNhbXBzXCI7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9ZWxzZSBpZiAocGFzc3dvcmQgPT09IHBhc3N3b3JkMil7XG4gICAgICAgICAgICAgICAgVXNlclN2Yy5yZWdpc3RyZSh1c2VybmFtZSxwYXNzd29yZClcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyb3Isc3RhdHVzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDA5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJMZXMgY29udHJhc2VueWVzIG5vIHPDs24gaWd1YWxzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG4gICAgIiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgICAgICAud2hlbihcIi9cIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNaXNzYXRnZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21pc3NhdGdlcy5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL25vdW1pc3NhdGdlXCIsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk5vdU1pc3NhdGdlQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbm91TWlzc2F0Z2UuaHRtbCcsXG4gICAgICAgICAgICAgICAgYXV0b3JpdHphdDogdHJ1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2VkaXRhcm1pc3NhdGdlXCIsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkVkaXRhck1pc3NhdGdlQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZWRpdGFyTWlzc2F0Z2UuaHRtbCcsXG4gICAgICAgICAgICAgICAgYXV0b3JpdHphdDogdHJ1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL3JlZ2lzdHJlXCIsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIlJlZ2lzdGVyQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInJlZ2lzdGVyLmh0bWxcIixcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2xvZ2luXCIsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkxvZ2luQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImxvZ2luLmh0bWxcIixcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL3JlZ2lzdHJlXCIsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIlJlZ2lzdHJlQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInJlZ2lzdHJlLmh0bWxcIixcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgfSlcbiAgICAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUsVXNlclN2Yykge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCwgbmV4dCkge1xuICAgICAgICAgICBpZiAobmV4dClcbiAgICAgICAgICAgICAgICBpZiAoIVVzZXJTdmMuYXV0aCAmIG5leHQuYXV0b3JpdHphdCkgXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLnNlcnZpY2UoJ1VzZXJTdmMnLCBmdW5jdGlvbigkaHR0cCkge1xuICAgICAgICB2YXIgc3ZjID0gdGhpcztcbiAgICAgICAgc3ZjLmF1dGg9IGZhbHNlO1xuICAgICAgICBzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VycycpO1xuICAgICAgICB9O1xuICAgICAgICBzdmMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLG5vTG9naW4pIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSxzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBzdmMudG9rZW4gPSBkYXRhO1xuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyd4LWF1dGgnXSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEpIHN2Yy5hdXRoID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yLHN0YXR1cyl7XG4gICAgICAgICAgICAgICAgbm9Mb2dpbihlcnJvciwgc3RhdHVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBzdmMucmVnaXN0cmUgPSBmdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCl7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgc3ZjLmxvZ091dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc3ZjLmF1dGggPSBmYWxzZTtcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyd4LWF1dGgnXSA9XCJcIjtcbiAgICAgICAgfTtcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=