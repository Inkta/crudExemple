angular.module("appLearn",["ngRoute"]),angular.module("appLearn").controller("ApplicationController",["$scope","$location","UserSvc",function(e,t,o){e.$on("login",function(t,o){e.currentUser=o}),e.logout=function(){o.logOut(),delete e.currentUser,t.path("/")}}]),angular.module("appLearn").controller("EditarMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.missatgeBody=o.missatgeToEdit.body,e.editarMissatge=function(){e.missatgeBody&&o.put({_id:o.missatgeToEdit._id,body:e.missatgeBody}).success(function(){o.missatgeToEdit.body=e.missatgeBody,e.missatgeBody=null,t.path("/")})}}]),angular.module("appLearn").controller("LoginController",["$scope","$location","UserSvc",function(e,t,o){e.$watchGroup(["username","password"],function(t,o){t!=o&&(e.error=null)}),e.login=function(r,s){r&&s?(console.log(o),o.login(r,s,function(t,o){401==o&&(e.error=t.missatge)}).success(function(){o.getUser().then(function(o){e.$emit("login",o.data),t.path("/")})})):e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").controller("MissatgesController",["$scope","$location","MissatgesService",function(e,t,o){o.fetch().success(function(t){e.missatges=t}),e.esborrarMissatge=function(t){o["delete"](t._id).success(function(){var o=e.missatges.indexOf(t);e.missatges.splice(o,1)})},e.editarMissatge=function(e){o.edit(e),t.path("/editarmissatge")}}]),angular.module("appLearn").service("MissatgesService",["$http",function(e){this.fetch=function(){return e.get("/api/missatges")},this.create=function(t){return e.post("/api/missatges",t)},this["delete"]=function(t){return console.log(t),e["delete"]("/api/missatges/"+t)},this.edit=function(e){this.missatgeToEdit=e},this.put=function(t){return e.put("/api/missatges",t)}}]),angular.module("appLearn").controller("NouMissatgeController",["$scope","$location","MissatgesService",function(e,t,o){e.afegirMissatge=function(){console.log(e.missatgeBody),e.missatgeBody&&o.create({body:e.missatgeBody}).success(function(){t.path("/")})}}]),angular.module("appLearn").controller("RegistreController",["$scope","$location","UserSvc",function(e,t,o){e.registre=function(r,s,n){e.$watchGroup(["username","password","password2"],function(t,o){t!=o&&(e.error=null)}),s&&n&&r?s===n?o.registre(r,s).success(function(){t.path("/login")}).error(function(t,o){409==o&&(e.error=t.missatge)}):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("appLearn").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{controller:"MissatgesController",templateUrl:"missatges.html",autoritzat:!1}).when("/noumissatge",{controller:"NouMissatgeController",templateUrl:"nouMissatge.html",autoritzat:!0}).when("/editarmissatge",{controller:"EditarMissatgeController",templateUrl:"editarMissatge.html",autoritzat:!0}).when("/registre",{controller:"RegisterController",templateUrl:"register.html",autoritzat:!1}).when("/login",{controller:"LoginController",templateUrl:"login.html",autoritzat:!1}).when("/registre",{controller:"RegistreController",templateUrl:"registre.html",autoritzat:!1}).otherwise({redirectTo:"/"}),t.html5Mode({enabled:!0,requireBase:!1})}]).run(["$rootScope","UserSvc",function(e,t){e.$on("$routeChangeStart",function(e,o){o&&!t.auth&o.autoritzat&&e.preventDefault()})}]),angular.module("appLearn").service("UserSvc",["$http",function(e){var t=this;t.auth=!1,t.getUser=function(){return e.get("/api/users")},t.login=function(o,r,s){return e.post("/api/sessions",{username:o,password:r}).success(function(o){t.token=o,e.defaults.headers.common["x-auth"]=o,o&&(t.auth=!0)}).error(function(e,t){s(e,t)})},t.registre=function(t,o){return e.post("/api/users",{username:t,password:o})},t.logOut=function(){t.auth=!1,e.defaults.headers.common["x-auth"]=""}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJlZGl0TWlzc2F0Z2UuY3RybC5qcyIsImxvZ2luLmN0cmwuanMiLCJtaXNzYXRnZXMuY3RybC5qcyIsIm1pc3NhdGdlcy5zdmMuanMiLCJub3VNaXNzYXRnZS5jdHJsLmpzIiwicmVnaXN0cmUuY3RybC5qcyIsInJvdXRlcy5qcyIsInVzZXIuc3ZjLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiVXNlclN2YyIsIiRvbiIsImUiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJsb2dPdXQiLCJwYXRoIiwiTWlzc2F0Z2VzU2VydmljZSIsIm1pc3NhdGdlQm9keSIsIm1pc3NhdGdlVG9FZGl0IiwiYm9keSIsImVkaXRhck1pc3NhdGdlIiwicHV0IiwiX2lkIiwic3VjY2VzcyIsIiR3YXRjaEdyb3VwIiwibmV3VmFsIiwib2xkVmFsIiwiZXJyb3IiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwibWlzc2F0Z2UiLCJnZXRVc2VyIiwidGhlbiIsIiRlbWl0IiwiZGF0YSIsImZldGNoIiwibWlzc2F0Z2VzIiwiZXNib3JyYXJNaXNzYXRnZSIsInBvcyIsImluZGV4T2YiLCJzcGxpY2UiLCJlZGl0Iiwic2VydmljZSIsIiRodHRwIiwidGhpcyIsImdldCIsImNyZWF0ZSIsInBvc3QiLCJpZCIsImFmZWdpck1pc3NhdGdlIiwicmVnaXN0cmUiLCJwYXNzd29yZDIiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiYXV0b3JpdHphdCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJodG1sNU1vZGUiLCJlbmFibGVkIiwicmVxdWlyZUJhc2UiLCJydW4iLCIkcm9vdFNjb3BlIiwiZXZlbnQiLCJuZXh0IiwiYXV0aCIsInByZXZlbnREZWZhdWx0Iiwic3ZjIiwibm9Mb2dpbiIsInRva2VuIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFBQUMsT0FBQSxZQUFBLFlDQUFELFFBQUFDLE9BQUEsWUFDQUMsV0FBQSx5QkFBQSxTQUFBLFlBQUEsVUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBRixFQUFBRyxJQUFBLFFBQUEsU0FBQUMsRUFBQUMsR0FDQUwsRUFBQU0sWUFBQUQsSUFFQUwsRUFBQU8sT0FBQSxXQUNBTCxFQUFBTSxlQUNBUixHQUFBTSxZQUNBTCxFQUFBUSxLQUFBLFNDUkFaLFFBQUFDLE9BQUEsWUFDQUMsV0FBQSw0QkFBQSxTQUFBLFlBQUEsbUJBQUEsU0FBQUMsRUFBQUMsRUFBQVMsR0FDQVYsRUFBQVcsYUFBQUQsRUFBQUUsZUFBQUMsS0FDQWIsRUFBQWMsZUFBQSxXQUNBZCxFQUFBVyxjQUNBRCxFQUFBSyxLQUNBQyxJQUFBTixFQUFBRSxlQUFBSSxJQUNBSCxLQUFBYixFQUFBVyxlQUNBTSxRQUFBLFdBQ0FQLEVBQUFFLGVBQUFDLEtBQUFiLEVBQUFXLGFBQ0FYLEVBQUFXLGFBQUEsS0FDQVYsRUFBQVEsS0FBQSxXQ1hBWixRQUFBQyxPQUFBLFlBQ0FDLFdBQUEsbUJBQUEsU0FBQSxZQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQWtCLGFBQUEsV0FBQSxZQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEdBQUFDLElBQ0FwQixFQUFBcUIsTUFBQSxRQUdBckIsRUFBQXNCLE1BQUEsU0FBQUMsRUFBQUMsR0FDQUQsR0FBQUMsR0FHQUMsUUFBQUMsSUFBQXhCLEdBQ0FBLEVBQUFvQixNQUFBQyxFQUFBQyxFQUNBLFNBQUFILEVBQUFNLEdBQ0EsS0FBQUEsSUFDQTNCLEVBQUFxQixNQUFBQSxFQUFBTyxZQUVBWCxRQUFBLFdBRUFmLEVBQUEyQixVQUFBQyxLQUFBLFNBQUF6QixHQUVBTCxFQUFBK0IsTUFBQSxRQUFBMUIsRUFB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LEdBQUF6QixJQUNBeUIsR0FBQUYsTUFBQSxFQUNBRSxFQUFBdEMsUUFBQSxXQUNBLE1BQUFZLEdBQUFFLElBQUEsZUFFQXdCLEVBQUE3QyxNQUFBLFNBQUFDLEVBQUFDLEVBQUE0QyxHQUNBLE1BQUEzQixHQUFBSSxLQUFBLGlCQUNBdEIsU0FBQUEsRUFDQUMsU0FBQUEsSUFDQVAsUUFBQSxTQUFBZSxHQUNBbUMsRUFBQUUsTUFBQXJDLEVBQ0FTLEVBQUE2QixTQUFBQyxRQUFBQyxPQUFBLFVBQUF4QyxFQUNBQSxJQUFBbUMsRUFBQUYsTUFBQSxLQUNBNUMsTUFBQSxTQUFBQSxFQUFBTSxHQUNBeUMsRUFBQS9DLEVBQUFNLE1BR0F3QyxFQUFBbkIsU0FBQSxTQUFBekIsRUFBQUMsR0FDQSxNQUFBaUIsR0FBQUksS0FBQSxjQUNBdEIsU0FBQUEsRUFDQUMsU0FBQUEsS0FHQTJDLEVBQUEzRCxPQUFBLFdBQ0EyRCxFQUFBRixNQUFBLEVBQ0F4QixFQUFBNkIsU0FBQUMsUUFBQUMsT0FBQSxVQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicsWyduZ1JvdXRlJ10pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJBcHBsaWNhdGlvbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oZSx1c2VyKSB7XG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBVc2VyU3ZjLmxvZ091dCgpO1xuICAgICAgICAgICAgZGVsZXRlICRzY29wZS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgIH07XG4gICAgfSk7XG4gICAgXG4gICAgIiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuY29udHJvbGxlcignRWRpdGFyTWlzc2F0Z2VDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLm1pc3NhdGdlQm9keSA9IE1pc3NhdGdlc1NlcnZpY2UubWlzc2F0Z2VUb0VkaXQuYm9keTtcbiAgICAgICAgJHNjb3BlLmVkaXRhck1pc3NhdGdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm1pc3NhdGdlQm9keSl7XG4gICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5wdXQoe1xuICAgICAgICAgICAgICAgICAgICBcIl9pZFwiOk1pc3NhdGdlc1NlcnZpY2UubWlzc2F0Z2VUb0VkaXQuX2lkLFxuICAgICAgICAgICAgICAgICAgICBcImJvZHlcIjokc2NvcGUubWlzc2F0Z2VCb2R5XG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5taXNzYXRnZVRvRWRpdC5ib2R5ID0gJHNjb3BlLm1pc3NhdGdlQm9keTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc3NhdGdlQm9keT1udWxsO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJMb2dpbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWyd1c2VybmFtZScsJ3Bhc3N3b3JkJ10sZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsIT1vbGRWYWwpXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcj1udWxsO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLHBhc3N3b3JkKSB7XG4gICAgICAgICAgICBpZiAoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiSGFzIGQnZW1wbGVuYXIgdG90cyBlbHMgY2FtcHNcIjtcbiAgICAgICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhVc2VyU3ZjKTtcbiAgICAgICAgICAgICAgICBVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnJvcixzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU3ZjLmdldFVzZXIoKS50aGVuKGZ1bmN0aW9uKHVzZXIpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwTGVhcm4nKVxuICAgIC5jb250cm9sbGVyKCdNaXNzYXRnZXNDb250cm9sbGVyJyxmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uLE1pc3NhdGdlc1NlcnZpY2UpIHtcbiAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5mZXRjaCgpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKG1pc3NhdGdlcyl7XG4gICAgICAgICAgICAkc2NvcGUubWlzc2F0Z2VzID0gbWlzc2F0Z2VzO1xuICAgICAgICB9KTtcblxuICAgICAgXG4gICAgICAgICRzY29wZS5lc2JvcnJhck1pc3NhdGdlID0gZnVuY3Rpb24obWlzc2F0Z2UpIHtcbiAgICAgICAgICAgIE1pc3NhdGdlc1NlcnZpY2UuZGVsZXRlKG1pc3NhdGdlLl9pZCkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gJHNjb3BlLm1pc3NhdGdlcy5pbmRleE9mKG1pc3NhdGdlKTtcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2F0Z2VzLnNwbGljZShwb3MsMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5lZGl0YXJNaXNzYXRnZSA9IGZ1bmN0aW9uKG1pc3NhdGdlKSB7XG4gICAgICAgICAgICBNaXNzYXRnZXNTZXJ2aWNlLmVkaXQobWlzc2F0Z2UpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9lZGl0YXJtaXNzYXRnZScpO1xuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLnNlcnZpY2UoXCJNaXNzYXRnZXNTZXJ2aWNlXCIsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoXCIvYXBpL21pc3NhdGdlc1wiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihtaXNzYXRnZSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoXCIvYXBpL21pc3NhdGdlc1wiLCBtaXNzYXRnZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGVsZXRlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoXCIvYXBpL21pc3NhdGdlcy9cIitpZCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZWRpdCA9IGZ1bmN0aW9uKG1pc3NhdGdlKXtcbiAgICAgICAgICAgIHRoaXMubWlzc2F0Z2VUb0VkaXQgPSBtaXNzYXRnZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wdXQgPSBmdW5jdGlvbihtaXNzYXRnZSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dChcIi9hcGkvbWlzc2F0Z2VzXCIsIG1pc3NhdGdlKTtcbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoJ05vdU1pc3NhdGdlQ29udHJvbGxlcicsZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixNaXNzYXRnZXNTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5hZmVnaXJNaXNzYXRnZSA9IGZ1bmN0aW9uKHBhdGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLm1pc3NhdGdlQm9keSk7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm1pc3NhdGdlQm9keSl7XG4gICAgICAgICAgICAgICAgTWlzc2F0Z2VzU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBib2R5OiRzY29wZS5taXNzYXRnZUJvZHlcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbnRyb2xsZXIoXCJSZWdpc3RyZUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbixVc2VyU3ZjKSB7XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUucmVnaXN0cmUgPSBmdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCxwYXNzd29yZDIpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaEdyb3VwKFsndXNlcm5hbWUnLCdwYXNzd29yZCcsJ3Bhc3N3b3JkMiddLGZ1bmN0aW9uKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCE9b2xkVmFsKVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3I9bnVsbDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFwYXNzd29yZCB8fCAhcGFzc3dvcmQyIHx8ICF1c2VybmFtZSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJIYXMgZCdlbXBsZW5hciB0b3RzIGVscyBjYW1wc1wiO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfWVsc2UgaWYgKHBhc3N3b3JkID09PSBwYXNzd29yZDIpe1xuICAgICAgICAgICAgICAgIFVzZXJTdmMucmVnaXN0cmUodXNlcm5hbWUscGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yLHN0YXR1cyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwOSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiTGVzIGNvbnRyYXNlbnllcyBubyBzw7NuIGlndWFsc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuICAgICIsImFuZ3VsYXIubW9kdWxlKCdhcHBMZWFybicpXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKFwiL1wiLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ01pc3NhdGdlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWlzc2F0Z2VzLmh0bWwnLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbm91bWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTm91TWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdub3VNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvZWRpdGFybWlzc2F0Z2VcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiRWRpdGFyTWlzc2F0Z2VDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGl0YXJNaXNzYXRnZS5odG1sJyxcbiAgICAgICAgICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0ZXJDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0ZXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvbG9naW5cIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTG9naW5Db250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwibG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvcmVnaXN0cmVcIiwge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiUmVnaXN0cmVDb250cm9sbGVyXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0cmUuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm90aGVyd2lzZSh7XG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZUJhc2U6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSxVc2VyU3ZjKSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBuZXh0KSB7XG4gICAgICAgICAgIGlmIChuZXh0KVxuICAgICAgICAgICAgICAgIGlmICghVXNlclN2Yy5hdXRoICYgbmV4dC5hdXRvcml0emF0KSBcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcExlYXJuJylcbiAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHZhciBzdmMgPSB0aGlzO1xuICAgICAgICBzdmMuYXV0aD0gZmFsc2U7XG4gICAgICAgIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsbm9Mb2dpbikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLHN0YXR1cykge1xuICAgICAgICAgICAgICAgIHN2Yy50b2tlbiA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gZGF0YTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgc3ZjLmF1dGggPSB0cnVlO1xuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Isc3RhdHVzKXtcbiAgICAgICAgICAgICAgICBub0xvZ2luKGVycm9yLCBzdGF0dXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHN2Yy5yZWdpc3RyZSA9IGZ1bmN0aW9uKHVzZXJuYW1lLHBhc3N3b3JkKXtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBzdmMubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdmMuYXV0aCA9IGZhbHNlO1xuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID1cIlwiO1xuICAgICAgICB9O1xuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==